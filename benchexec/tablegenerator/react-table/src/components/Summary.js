// This file is part of BenchExec, a framework for reliable benchmarking:
// https://github.com/sosy-lab/benchexec
//
// SPDX-FileCopyrightText: 2019-2020 Dirk Beyer <https://www.sosy-lab.org>
//
// SPDX-License-Identifier: Apache-2.0

import React from "react";
import "react-table/react-table.css";

import "react-table-hoc-fixed-columns/lib/styles.css";
import StatisticsTable from "./StatisticsTable";

export default class Summary extends React.PureComponent {
  constructor(props) {
    super(props);
    this.infos = [
      "displayName",
      "tool",
      "limit",
      "host",
      "os",
      "system",
      "date",
      "runset",
      "branch",
      "options",
      "property",
    ];
    this.headerWidth = window.innerWidth * 0.15;
    this.width = window.innerWidth;
  }

  renderEnvironmentRow = (row, text, colSpan, j) => {
    if (row === "options") {
      return (
        <td
          colSpan={colSpan}
          key={text + j}
          className="header__tool-row options"
        >
          <ul>{this.renderOptions(text)}</ul>
        </td>
      );
    }
    return (
      <td colSpan={colSpan} key={text + j} className="header__tool-row">
        {text}{" "}
      </td>
    );
  };
  renderOptions = (text) => {
    return text.split(/[\s]+-/).map((option, i) => (
      <li key={option}>
        <code>{i === 0 ? option : `-${option}`}</code>
      </li>
    ));
  };

  render() {
    return (
      <div id="summary">
        <div id="benchmark_setup">
          <h2>Benchmark Setup</h2>
          <table>
            <tbody>
              {this.infos
                .map((row) => this.props.tableHeader[row])
                .filter((row) => row !== null)
                .map((row, i) => (
                  <tr key={"tr-" + row.id} className={row.id}>
                    <th key={"td-" + row.id}>{row.name}</th>
                    {row.content.map((tool, j) =>
                      this.renderEnvironmentRow(row.id, tool[0], tool[1], j),
                    )}
                  </tr>
                ))}
            </tbody>
          </table>
        </div>
        <StatisticsTable
          width={this.width}
          selectColumn={this.props.selectColumn}
          tools={this.props.tools}
          changeTab={this.props.changeTab}
          hiddenCols={this.props.hiddenCols}
          data={this.props.data}
          onStatsReady={this.props.onStatsReady}
          headerWidth={this.headerWidth}
          stats={this.props.stats}
        />
        <p>
          Generated by{" "}
          <a
            className="link"
            href="https://github.com/sosy-lab/benchexec"
            target="_blank"
            rel="noopener noreferrer"
          >
            {" "}
            BenchExec {this.props.version}
          </a>
        </p>
      </div>
    );
  }
}
